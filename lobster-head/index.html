<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SID - The Lobster ü¶û</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0a 50%, #0a0a0a 100%);
      font-family: 'Courier New', monospace;
      height: 100vh;
      overflow: hidden;
    }
    
    #canvas { 
      display: block; 
      width: 100%; 
      height: 100%; 
    }
    
    #speech-box {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      border: 2px solid #ff4444;
      border-radius: 10px;
      padding: 12px 20px;
      color: #fff;
      font-size: 16px;
      max-width: 500px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 10;
    }
    #speech-box.visible { opacity: 1; }
    
    /* Chat Terminal Overlay */
    #chat-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #cc2200, #ff4444);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 28px;
      color: white;
      box-shadow: 0 4px 20px rgba(255,68,68,0.4);
      transition: all 0.3s;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #chat-toggle:hover { 
      transform: scale(1.1); 
      box-shadow: 0 6px 30px rgba(255,68,68,0.6);
    }
    #chat-toggle.open { background: #333; }
    
    #chat-terminal {
      position: fixed;
      bottom: 100px;
      right: 20px;
      width: 380px;
      height: 450px;
      background: rgba(10, 10, 10, 0.95);
      border: 1px solid #ff4444;
      border-radius: 12px;
      display: none;
      flex-direction: column;
      z-index: 999;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      overflow: hidden;
    }
    #chat-terminal.open { display: flex; }
    
    #chat-header {
      background: linear-gradient(135deg, #cc2200, #991100);
      padding: 12px 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid #ff4444;
    }
    #chat-header .title {
      flex: 1;
      font-weight: bold;
      color: #fff;
      font-size: 14px;
    }
    #chat-header .status {
      font-size: 10px;
      color: #88ff88;
    }
    #chat-header .close-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      opacity: 0.7;
    }
    #chat-header .close-btn:hover { opacity: 1; }
    
    #chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 13px;
    }
    
    #chat-messages::-webkit-scrollbar { width: 6px; }
    #chat-messages::-webkit-scrollbar-track { background: #111; }
    #chat-messages::-webkit-scrollbar-thumb { background: #ff4444; border-radius: 3px; }
    
    .msg {
      max-width: 85%;
      padding: 8px 12px;
      border-radius: 12px;
      line-height: 1.4;
      animation: fadeIn 0.2s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .msg.user {
      background: #2a2a2a;
      color: #fff;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    
    .msg.sid {
      background: linear-gradient(135deg, #cc2200, #aa1100);
      color: #fff;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    
    .msg.system {
      background: transparent;
      color: #666;
      font-size: 11px;
      text-align: center;
      align-self: center;
    }
    
    .typing {
      display: flex;
      gap: 4px;
      padding: 8px 12px;
    }
    .typing span {
      width: 6px;
      height: 6px;
      background: #888;
      border-radius: 50%;
      animation: bounce 1.4s ease-in-out infinite;
    }
    .typing span:nth-child(2) { animation-delay: 0.2s; }
    .typing span:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes bounce {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }
    
    #chat-input-area {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: #0a0a0a;
      border-top: 1px solid #222;
    }
    
    #chat-input {
      flex: 1;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 20px;
      padding: 10px 15px;
      color: #fff;
      font-family: inherit;
      font-size: 13px;
      outline: none;
    }
    #chat-input:focus { border-color: #ff4444; }
    #chat-input::placeholder { color: #555; }
    
    #send-btn {
      background: #ff4444;
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }
    #send-btn:hover { background: #ff6666; }
    #send-btn:disabled { background: #444; }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="speech-box"></div>
  
  <!-- Chat Toggle Button -->
  <button id="chat-toggle" onclick="toggleChat()">ü¶û</button>
  
  <!-- Chat Terminal -->
  <div id="chat-terminal">
    <div id="chat-header">
      <span class="title">ü¶û SID Terminal</span>
      <span class="status">‚óè online</span>
      <button class="close-btn" onclick="toggleChat()">‚úï</button>
    </div>
    <div id="chat-messages">
      <div class="msg system">Type a message to chat with SID</div>
    </div>
    <div id="chat-input-area">
      <input type="text" id="chat-input" placeholder="Say something..." autocomplete="off">
      <button id="send-btn">‚û§</button>
    </div>
  </div>

  <script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
  </script>
  
  <script type="module">
    import * as THREE from 'three';
    
    // ============ CHAT ============
    let chatOpen = false;
    let isSpeaking = false;
    let speakingTime = 0;
    
    window.toggleChat = function() {
      chatOpen = !chatOpen;
      document.getElementById('chat-terminal').classList.toggle('open', chatOpen);
      document.getElementById('chat-toggle').classList.toggle('open', chatOpen);
      document.getElementById('chat-toggle').textContent = chatOpen ? '‚úï' : 'ü¶û';
      if (chatOpen) document.getElementById('chat-input').focus();
    };
    
    // ============ THREE.JS ============
    const canvas = document.getElementById('canvas');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 0, 5);
    
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
    
    // Lighting
    scene.add(new THREE.AmbientLight(0xffffff, 0.4));
    const keyLight = new THREE.DirectionalLight(0xffffff, 1);
    keyLight.position.set(2, 3, 4);
    scene.add(keyLight);
    scene.add(new THREE.DirectionalLight(0xff4444, 0.3).translateX(-2));
    scene.add(new THREE.DirectionalLight(0xff8844, 0.5).translateY(-2).translateZ(-3));
    
    // ============ LOBSTER ============
    const lobster = new THREE.Group();
    scene.add(lobster);
    
    const shellMat = new THREE.MeshStandardMaterial({ color: 0xcc2200, roughness: 0.4, metalness: 0.1 });
    const darkMat = new THREE.MeshStandardMaterial({ color: 0x881100, roughness: 0.5 });
    const eyeMat = new THREE.MeshStandardMaterial({ color: 0x000000, roughness: 0.1, metalness: 0.8 });
    const eyeWhiteMat = new THREE.MeshStandardMaterial({ color: 0xffffcc, emissive: 0x444422, roughness: 0.3 });
    const antMat = new THREE.MeshStandardMaterial({ color: 0xdd4422 });
    
    // Head
    const headGeom = new THREE.SphereGeometry(1, 32, 32);
    headGeom.scale(1, 0.8, 1.1);
    lobster.add(new THREE.Mesh(headGeom, shellMat));
    
    // Ridge + spikes
    const ridge = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.3, 1.2), darkMat);
    ridge.position.set(0, 0.7, 0.1);
    lobster.add(ridge);
    for (let i = 0; i < 5; i++) {
      const spike = new THREE.Mesh(new THREE.ConeGeometry(0.05, 0.15, 8), darkMat);
      spike.position.set(0, 0.85, -0.4 + i * 0.2);
      lobster.add(spike);
    }
    
    // Eye stalks
    const stalkGeom = new THREE.CylinderGeometry(0.08, 0.1, 0.4, 16);
    const lStalk = new THREE.Mesh(stalkGeom, shellMat);
    lStalk.position.set(-0.35, 0.5, 0.7);
    lStalk.rotation.set(-0.5, 0, -0.3);
    lobster.add(lStalk);
    const rStalk = new THREE.Mesh(stalkGeom, shellMat);
    rStalk.position.set(0.35, 0.5, 0.7);
    rStalk.rotation.set(-0.5, 0, 0.3);
    lobster.add(rStalk);
    
    // Eyes
    const eyeGeom = new THREE.SphereGeometry(0.12, 16, 16);
    const lEye = new THREE.Mesh(eyeGeom, eyeWhiteMat);
    lEye.position.set(-0.45, 0.7, 0.9);
    lobster.add(lEye);
    const rEye = new THREE.Mesh(eyeGeom, eyeWhiteMat);
    rEye.position.set(0.45, 0.7, 0.9);
    lobster.add(rEye);
    
    // Pupils
    const pupilGeom = new THREE.SphereGeometry(0.06, 16, 16);
    const lPupil = new THREE.Mesh(pupilGeom, eyeMat);
    lPupil.position.set(-0.45, 0.7, 1.02);
    lobster.add(lPupil);
    const rPupil = new THREE.Mesh(pupilGeom, eyeMat);
    rPupil.position.set(0.45, 0.7, 1.02);
    lobster.add(rPupil);
    
    // Antennae
    function makeAnt(sign) {
      const g = new THREE.Group();
      for (let i = 0; i < 6; i++) {
        const s = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.025, 0.25, 8), antMat);
        s.position.y = i * 0.22;
        s.rotation.z = sign * i * 0.15;
        s.rotation.x = -i * 0.1;
        g.add(s);
      }
      return g;
    }
    const lAnt = makeAnt(-1);
    lAnt.position.set(-0.3, 0.7, 0.8);
    lobster.add(lAnt);
    const rAnt = makeAnt(1);
    rAnt.position.set(0.3, 0.7, 0.8);
    lobster.add(rAnt);
    
    // Mandibles + jaw
    const mandGeom = new THREE.BoxGeometry(0.15, 0.08, 0.3);
    const lMand = new THREE.Mesh(mandGeom, darkMat);
    lMand.position.set(-0.2, -0.1, 0.9);
    lobster.add(lMand);
    const rMand = new THREE.Mesh(mandGeom, darkMat);
    rMand.position.set(0.2, -0.1, 0.9);
    lobster.add(rMand);
    const jaw = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.1, 0.25), darkMat);
    jaw.position.set(0, -0.3, 0.85);
    lobster.add(jaw);
    
    // ============ ANIMATION ============
    const mouse = { x: 0, y: 0 };
    let blinkTimer = 0, isBlinking = false;
    
    document.addEventListener('mousemove', e => {
      mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    });
    
    const clock = new THREE.Clock();
    
    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();
      const t = clock.getElapsedTime();
      
      lobster.rotation.y = Math.sin(t * 0.5) * 0.1;
      lobster.rotation.x = Math.sin(t * 0.3) * 0.05;
      
      lPupil.position.x = -0.45 + mouse.x * 0.05;
      lPupil.position.y = 0.7 + mouse.y * 0.03;
      rPupil.position.x = 0.45 + mouse.x * 0.05;
      rPupil.position.y = 0.7 + mouse.y * 0.03;
      
      blinkTimer += delta;
      if (!isBlinking && blinkTimer > 3 + Math.random() * 2) { isBlinking = true; blinkTimer = 0; }
      if (isBlinking) {
        const p = blinkTimer * 10;
        const s = p < 1 ? 1 - p : (p < 2 ? p - 1 : 1);
        lEye.scale.y = rEye.scale.y = lPupil.scale.y = rPupil.scale.y = s;
        if (p > 2) isBlinking = false;
      }
      
      lAnt.rotation.z = -0.2 + Math.sin(t * 1.5) * 0.1;
      rAnt.rotation.z = 0.2 + Math.sin(t * 1.5 + 0.5) * 0.1;
      
      if (isSpeaking) {
        speakingTime += delta;
        const open = Math.sin(speakingTime * 20) * 0.5 + 0.5;
        lMand.rotation.z = -open * 0.3;
        rMand.rotation.z = open * 0.3;
        jaw.position.y = -0.3 - open * 0.1;
      } else {
        lMand.rotation.z *= 0.9;
        rMand.rotation.z *= 0.9;
        jaw.position.y += (-0.3 - jaw.position.y) * 0.1;
      }
      
      renderer.render(scene, camera);
    }
    animate();
    
    // ============ CHAT LOGIC ============
    const msgBox = document.getElementById('chat-messages');
    const input = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const speechBox = document.getElementById('speech-box');
    
    function addMsg(text, type) {
      const div = document.createElement('div');
      div.className = `msg ${type}`;
      div.textContent = text;
      msgBox.appendChild(div);
      msgBox.scrollTop = msgBox.scrollHeight;
      return div;
    }
    
    function showSpeech(text) {
      speechBox.textContent = text;
      speechBox.classList.add('visible');
      isSpeaking = true;
      speakingTime = 0;
      setTimeout(() => { speechBox.classList.remove('visible'); isSpeaking = false; }, Math.min(text.length * 60 + 1000, 4000));
    }
    
    function getResponse(text) {
      const l = text.toLowerCase();
      const p = [
        [/\b(gm|good morning)\b/, ["Gm gm! ü¶û", "Gm dude!"]],
        [/\b(gn|good night)\b/, ["Gn bro! ü¶û", "Sleep well!"]],
        [/\b(hello|hi|hey|sup|yo)\b/, ["Yo! ü¶û", "Hey!", "Sup dude!"]],
        [/how are you/, ["Chillin! You? ü¶û"]],
        [/thanks|thank you/, ["No prob! ü¶û"]],
        [/who are you/, ["I'm Sid - a chill AI lobster ü¶û"]],
        [/love you/, ["Love you too! ü¶û‚ù§Ô∏è"]],
      ];
      for (const [r, a] of p) if (r.test(l)) return a[Math.floor(Math.random() * a.length)];
      return ["Vibes ü¶û", "I hear you", "For sure", "Nice one"][Math.floor(Math.random() * 4)];
    }
    
    async function send() {
      const text = input.value.trim();
      if (!text) return;
      input.value = '';
      sendBtn.disabled = true;
      
      addMsg(text, 'user');
      
      const typing = document.createElement('div');
      typing.className = 'msg sid typing';
      typing.innerHTML = '<span></span><span></span><span></span>';
      msgBox.appendChild(typing);
      msgBox.scrollTop = msgBox.scrollHeight;
      
      await new Promise(r => setTimeout(r, 600 + Math.random() * 400));
      
      typing.remove();
      const resp = getResponse(text);
      addMsg(resp, 'sid');
      showSpeech(resp);
      
      sendBtn.disabled = false;
      input.focus();
    }
    
    sendBtn.onclick = send;
    input.onkeypress = e => { if (e.key === 'Enter') send(); };
  </script>
</body>
</html>
